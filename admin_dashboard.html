
<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ù…Ø·Ø¹Ù… Ø±ÙŠØ¯Ø§Ù†</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
  <style>
    body { font-family: Arial; direction: rtl; padding: 20px; background: #f5f5f5; }
    h2 { color: #c0392b; }
    select, button { margin: 5px 0; padding: 5px; }
    .order { background: #fff; margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
  </style>
</head>
<body>
  <h2>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h2>

  <label>Ø§Ø®ØªØ± Ø§Ù„ÙØ±Ø¹:</label>
  <select id="branchSelector">
    <option value="Ø¯Ø¨ÙŠ">ÙØ±Ø¹ Ø¯Ø¨ÙŠ</option>
    <option value="Ø§Ù„Ø´Ø§Ø±Ù‚Ø©">ÙØ±Ø¹ Ø§Ù„Ø´Ø§Ø±Ù‚Ø©</option>
  </select>

  <div id="orders"></div>

  <audio id="notificationSound" src="https://www.soundjay.com/buttons/sounds/button-29.mp3" preload="auto"></audio>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyA8zqzbD56Ts3wjOySYm4Blq2qh93CZZMk",
      authDomain: "raidan-3857c.firebaseapp.com",
      projectId: "raidan-3857c",
      storageBucket: "raidan-3857c.firebasestorage.app",
      messagingSenderId: "827435463070",
      appId: "1:827435463070:web:37fe023b378b1a7d33a68f",
      measurementId: "G-7EZG1W4QCV"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const ordersDiv = document.getElementById("orders");
    const branchSelector = document.getElementById("branchSelector");
    const sound = document.getElementById("notificationSound");

    let lastDocIds = new Set();

    function renderOrders(branch) {
      db.collection("Orders").where("branch", "==", branch).orderBy("timestamp", "desc")
        .onSnapshot(snapshot => {
          ordersDiv.innerHTML = "";
          snapshot.docChanges().forEach(change => {
            const data = change.doc.data();
            const id = change.doc.id;

            if (change.type === "added" && !lastDocIds.has(id)) {
              sound.play();
              lastDocIds.add(id);
            }

            const div = document.createElement("div");
            div.className = "order";
            div.innerHTML = `
              <strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${data.customer_name}<br>
              <strong>Ø§Ù„Ø¬ÙˆØ§Ù„:</strong> ${data.phone}<br>
              <strong>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</strong> ${data.address}<br>
              <strong>Ø§Ù„Ø·Ù„Ø¨:</strong> ${data.items}<br>
              <strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> ${data.status}<br>
              <button onclick="updateStatus('${id}', 'Ù‚ÙŠØ¯ Ø§Ù„ØªÙˆØµÙŠÙ„')">Ù‚ÙŠØ¯ Ø§Ù„ØªÙˆØµÙŠÙ„</button>
              <button onclick="updateStatus('${id}', 'ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„')">ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„</button>
              <button onclick="deleteOrder('${id}')">ğŸ—‘ Ø­Ø°Ù</button>
            `;
            ordersDiv.appendChild(div);
          });
        });
    }

    function updateStatus(id, status) {
      db.collection("Orders").doc(id).update({ status });
    }

    function deleteOrder(id) {
      if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ØŸ")) {
        db.collection("Orders").doc(id).delete();
      }
    }

    branchSelector.addEventListener("change", () => {
      lastDocIds.clear();
      renderOrders(branchSelector.value);
    });

    // Ø£ÙˆÙ„ ØªØ´ØºÙŠÙ„
    renderOrders(branchSelector.value);
  </script>
</body>
</html>
